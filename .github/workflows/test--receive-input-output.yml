on:
  workflow_call:
    inputs:
      image-name:
        required: true
        type: string
      image-tag:
        required: true
        type: string
    outputs:
      full-image-name:
        description: "Full pushed image name including host/registry, name, and tag"
        value: ${{ jobs.docker-build.outputs.full-image-name }}
jobs:
  docker-build:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
    timeout-minutes: 25
    outputs:
      full-image-name: ${{ steps.build-and-push-image.outputs.full-image-name }}

    steps:
      - name: "Build and push image"
        id: "build-and-push-image"
        run: |
          image_name_and_tag="${{ inputs.image-name }}:${{ inputs.image-tag }}"
          full_image_name="ghcr.io/${{ github.repository_owner }}/$image_name_and_tag"
          echo "image_name_and_tag=$image_name_and_tag"
          echo "full-image-name=$full_image_name"
          echo "full-image-name=$full_image_name" >> $GITHUB_OUTPUT
